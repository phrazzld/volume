# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project: Volume - Workout Tracker MVP

A simple workout tracking app built with Next.js 15, Convex backend, and Clerk authentication. Users can create exercises, log sets (reps + optional weight), and view their workout history.

## Tech Stack

- **Frontend**: Next.js 15 (App Router), React 19, TypeScript, Tailwind CSS, next-themes
- **Backend**: Convex (BaaS with real-time sync)
- **Auth**: Clerk (integrated with Convex)
- **Package Manager**: pnpm (v10.17.1)
- **Build Tool**: Turbopack (Next.js dev mode)

## Development Commands

```bash
# Development
pnpm dev                # Start Next.js dev server (Turbopack)
pnpm convex dev         # Start Convex dev server (run in separate terminal)

# Type Checking & Linting
pnpm typecheck          # Run TypeScript compiler checks (tsc --noEmit)
pnpm lint               # Run ESLint

# Testing
pnpm test               # Run tests (watch mode)
pnpm test:ui            # Run tests with UI
pnpm test:coverage      # Run tests with coverage report

# Production
pnpm build              # Build for production
pnpm start              # Start production server
```

## Architecture Overview

### Authentication Flow
- **Clerk Middleware** (`src/middleware.ts`): Protects all routes except `/sign-in` and `/sign-up`
- **Convex Integration**: Uses `ConvexProviderWithClerk` to sync auth state between Clerk and Convex
- **Auth Config**: `convex/auth.config.ts` configures Clerk JWT issuer for Convex

### Data Model (convex/schema.ts)
```typescript
exercises {
  userId: string          // Clerk user ID
  name: string           // Exercise name
  createdAt: number      // Unix timestamp

  indexes: by_user, by_user_name
}

sets {
  userId: string          // Clerk user ID
  exerciseId: Id<exercises>
  reps: number           // Number of repetitions
  weight?: number        // Optional weight
  performedAt: number    // Unix timestamp

  indexes: by_user, by_exercise, by_user_performed
}
```

### Convex Backend Functions

**exercises.ts**:
- `createExercise(name)` - mutation: Create new exercise for authenticated user
- `listExercises()` - query: Get all exercises for authenticated user (desc order)
- `deleteExercise(id)` - mutation: Delete exercise with ownership verification

**sets.ts**:
- `logSet(exerciseId, reps, weight?)` - mutation: Log new set with exercise ownership verification
- `listSets(exerciseId?)` - query: Get all sets or filter by exercise (desc order)
- `deleteSet(id)` - mutation: Delete set with ownership verification

**Security Pattern**: All mutations verify authentication and ownership before mutations

### Frontend Structure

```
src/
├── app/                          # Next.js App Router pages
│   ├── layout.tsx               # Root layout with Clerk + Convex providers
│   ├── page.tsx                 # Home page (log workout)
│   ├── exercises/page.tsx       # Manage exercises
│   ├── history/page.tsx         # View workout history
│   ├── log/page.tsx            # Log sets for exercise
│   └── ConvexClientProvider.tsx # Convex + Clerk integration
├── components/
│   ├── exercises/
│   │   ├── create-exercise-form.tsx    # Form to create exercises
│   │   └── exercise-selector.tsx       # Select exercise for logging
│   ├── sets/
│   │   ├── log-set-form.tsx           # Form to log sets
│   │   └── set-list.tsx               # Display sets with exercise names
│   ├── layout/
│   │   └── nav.tsx                     # Global navigation with user menu
│   └── ThemeProvider.tsx               # Dark mode support (next-themes)
└── middleware.ts                        # Clerk auth middleware
```

### Key Patterns

1. **Convex Hooks**: Use `useQuery` for data fetching, `useMutation` for mutations
   ```typescript
   const exercises = useQuery(api.exercises.listExercises);
   const createExercise = useMutation(api.exercises.createExercise);
   ```

2. **Auth State**: Access user via Clerk hooks (`useUser()`)

3. **Real-time Updates**: Convex queries automatically subscribe to changes

4. **Path Aliases**: Use `@/*` for `src/*` imports

## Environment Setup

Required `.env.local` variables:
```bash
# Convex (generated by `pnpm convex dev`)
NEXT_PUBLIC_CONVEX_URL=https://...convex.cloud

# Clerk (from dashboard.clerk.com)
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_SECRET_KEY=sk_test_...

# Clerk JWT (for Convex integration)
CLERK_JWT_ISSUER_DOMAIN=your-clerk-domain.clerk.accounts.dev
```

## First-Time Setup

1. Install dependencies: `pnpm install`
2. Start Convex dev server: `pnpm convex dev` (creates project + generates `.env.local`)
3. Set up Clerk application at dashboard.clerk.com and add keys to `.env.local`
4. Start Next.js dev server: `pnpm dev`

## Development Notes

- **Turbopack**: Development uses `--turbopack` flag for faster builds
- **TypeScript**: Strict mode enabled, use path aliases `@/*` for imports
- **Dark Mode**: Implemented via `next-themes` (see `ThemeProvider.tsx`)
- **Mobile-First**: UI is mobile-responsive (Tailwind CSS)

## Future Enhancements

See `BACKLOG.md` for planned post-MVP features including:
- Analytics & insights (PRs, streaks, charts)
- Offline-first architecture (Dexie + sync)
- Data export/import (CSV, JSON)
- Enhanced set logging UI (RPE, notes, undo)
- Workout sessions (optional grouping)
